# OSI参考模型中的一些概念

CLNP：无连接网络协议，他是为了OSI七层模型中网络层研发的协议
IP  ：他是为了TCP/IP模型中网络层研发的协议
ISIS路由协议最初是为了7层模型研发的，后来IETF对其做了扩充和修改，使其可以兼容TCP/IP模型，称为集成化的ISIS

在OSI参考模型中。将具有数据转发能力的节点叫做IS（中间系统intermediate system）,类似于TCP/IP模型中的路由器
			                 将不具有数据转发能力的节点叫做ES（端系统end system），类似于TCP/IP模型中的终端

==OSPF是工作在网络层之上的路由协议。==
==ISIS是工作在数据链路层之上的路由协议。==

# 区域的概念

1. 管理区域: Area ID （基于路由器的）
2. 算法区域：骨干区域和非骨干区域
                 骨干区域：由连续的L2或者L1/2的路由器组成的逻辑区域
                 非骨干区域：由连续的L1或者L1/2的路由器组成的逻辑区域
    注意：设计的时候一定要避免骨干区域被分割，ISIS不支持虚链路，没有补救措施


# 级别

## 1.路由器级别

level-1路由器
level-2路由器
level-1/2路由器（缺省）

## 2.邻居级别

level-1:和相同区域的L1路由器建立L1邻居，和不同区域的L1路由器无法建立邻居
           和相同区域的L2路由器无法建立邻居，和不同区域的L2路由器无法建立邻居
           和相同区域的L1/2路由器建立L1邻居，和不同区域的L1/2路由器无法建立邻居
           L1级别路由器只能和L1或者L1/2路由器建立L1级别邻居，且要求区域ID相同
level-2：和相同区域的L1路由器无法建立邻居，和不同区域的L1路由器无法建立邻居
            和相同区域的L2路由器建立L2邻居，和不同区域的L2路由器建立L2邻居
            和相同区域的L1/2路由器建立L2邻居，和不同区域的L1/2路由器建立L2邻居
           L2级别路由器只能和L2或者L1/2路由器建立L2级别邻居，且不要求区域ID相同
level-1/2：和相同区域的L1路由器建立L1邻居，和不同区域的L1路由器无法建立邻居
              和相同区域的L2路由器建立L2邻居，和不同区域的L2路由器建立L2邻居
              和相同区域的L1/2路由器建立L1和L2邻居，和不同区域的L1/2路由器建立L2邻居
总结:
==L1的路由器只支持建立L1级别的邻居，且要求区域ID相同==
==L2的路由器只支持建立L2级别的邻居，不要求区域ID相同==
==L1/2的路由器既支持L1级别邻居又支持L2级别邻居==

## 3.链路级别

1. L1的路由器，在广播链路上发送L1的hello报文，与链路级别无关，始终发送L1hello报文
2. L2的路由器，在广播链路上发送L2的hello报文，与链路级别无关，始终发送L2hello报文
3. ==L1/2的路由器，在广播链路上发送L1和L2的hello报文，与链路级别有关系，取交集发送==
4. 对于点到点链路，和广播链路是一致的
   总结：对于仅支持一种级别的路由器来说，链路级别不起作用
         对于支持两种级别的路由器来说，链路级别起作用，取交集发出

# ISIS的电路类型

1. 广播
	当链路层协议为以太网时，ISIS的电路类型默认为广播
2. 点到点
	当链路层协议为PPP或者HDLC，ISIS的电路类型默认为P2P

当电路类型为广播时（MA）需要选举DIS

# DIS

**DIS：伪节点**

**DIS的作用：**
1. 在SPF计算式，都会作为伪节点计算SPF树，将MA网络简单化计算
2. 都是为了减少LSA的泛洪（在ISIS里叫做LSP）
3. 在ISIS里，DIS在广播网络下用来保证LSDB同步的可靠性（新知识）

**DIS的选举：**
1. 接口的DIS优先级 0~127 默认为64 越大越优
2. 接口的MAC地址，越大越优

**抢占问题:**
1. 邻居状态
   OSPF的DR是不具备抢占的，MA网络下OSPF的路由器邻居状态有2way和full，一旦DR被抢占，那么full和2way
可能会大范围的改变，造成网络终端，OSPF重新收敛。
   ISIS的DIS是支持抢占的，MA网络下ISIS的路由器邻居状态全部都是邻接，DIS的改变，不会造成邻接状态的改变
 2. 从算法角度讲
   OSPF的DR可以看做是2类LSA，如果2类LSA被抢占了，那么会造成SPF树重新计算。
   ISIS的DIS被抢占的话，伪节点的信息发生改变，会导致其他路由器重新计算。

# ISIS报文发送地址

广播链路上L1的报文发送目的组播MAC：01-80-C2-00-00-14
广播链路上L2的报文发送目的组播MAC：01-80-C2-00-00-15
如果在广播链路上修改电路类型为P2P后，那么发送报文的目的MAC地址：09-00-2B-00-00-05

# ISIS路由协议的邻居建立

## 邻居状态

1. down: 当接口宣告了ISIS进程以后，发出hello报文，在没有收到其他路由器发来的hello报文之前，处于down状态
2. init：当收到其他路由器发来的第一个hello包（且这个hello包里不包含自己的neighbor信息时）为Init初始状态
3. up  ：当收到了其他路由器的hello包且报文中包含自己接口Mac地址时（neighbor信息）为up状态。

OSPF的稳定邻居状态为2-WAY和FULL。
ISIS的稳定邻居状态只有UP（相当于邻接状态）

OSPF和ISIS的区别：
OSPF在建立2-way状态以后，指定了状态机来同步数据库
ISIS在建立UP状态以后，没有指定状态机来同步数据库

